# Chapter 3. 카프카 기본 개념 설명

## 3.1. 카프카 브로커, 클러스터, 주키퍼
- 카프카 브로커 : 카프카 클라이언트와 데이터를 주고받기 위해 사용하는 주체
- 데이터를 안전하게 보관, 처리하기 위해 **3대 이상의 브로커 서버를 1개의 클러스터로 묶어서 운영한다**
- 카프카 클러스터로 묶인 브로커들은 프로듀서가 보낸 데이터를 안전하게 분산 저장 및 복제하는 역할을 수행한다

### 데이터 저장, 전송
- 카프카는 `페이지 캐시` 를 사용해서 디스크 입출력 속도를 높여 파일 시스템의 처리 속도가 느린 문제를 해결했다
  - 페이지 캐시 : OS 에서 파일 입출력의 성능 향상을 위해 만들어 놓은 `메모리` 영역
  - 한번 읽은 파일 내용은 메모리의 페이지 캐시 영역에 저장한다. <br>
  추후 동일 파일 접근이 일어나면 **디스크에서 읽지 않고 메모리에서 직접 읽는다.**

### 데이터 복제, 싱크
- 카프카 데이터 복제는 `파티션` 단위로 이루어진다
- 복제 개수 최솟값은 1 (복제 없음), 최댓값은 브로커 개수만큼 설정가능
- 복제 개수가 3인 경우
![](image.png)
- 복제된 파티션은 `리더` 와 `팔로워` 로 구성된다
    - 리더 : 프로듀서 또는 컨슈머와 직접 통신하는 파티션
    - 팔로워 : 나머지 복제 데이터를 가지고 있는 파티션
      - 리더 파티션의 오프셋을 확인하여, 현재 자신이 가진 오프셋과 차이가 나면 리더 파티션으로부터 데이터를 가져와서 자신의 파티션에 저장. => 복제
      - 복제 개수만큼 저장용량이 증가한다는 단점 vs. 데이터를 안전하게 사용할 수 있다는 강력한 장점

### 컨트롤러(controller)
- 컨트롤러는 다른 브로커들의 상태를 체크하고, 브로커가 클러스터에서 빠지는 경우 해당 브로커에 존재하는 리더 파티션을 분배한다

#### 데이터 삭제