# Chatper 02. 카프카 빠르게 시작해보기

## 2.1 실습용 카프카 브로커 설치
- Amazon Linux2 AMI는 Amazon에서 직접 만든 템플릿으로서 EC2 성능에 최적화되어 있다.
- 카프카의 기본 포트는 9092이고 주키퍼의 기본 포트는 2181이다. -> 보안그룹에서 열어주기
### 자바 설치
  ```bash
  $ sudo ym install -y java-1.8.0-openjdk-devel.x86_64
  ```

### 주키퍼 & 카프카 브로커 실행
- 카프카 브로커를 실행하기 위해 카프카 바이너리 패키지를 다운로드
  - 카프카 파이너리 패키지 : 자바 소스코드를 컴파일하여 실행하기 위해 준비해놓은 파이너리 파일들이 들어있음
  - 카프카 공식 홈페이지에서 다운 가능
  - 두 가지 버전(2.12, 2.13)이 있는데 둘 다 실습 환경에서 실행시 차이가 없음
  ```bash
  $ wget https://archive.apache.org/dist/kafka/2.5.0/kafka_2.12-2.5.0.tgz
  $ tar xvf kafka_2.12-2.5.0. tgz
  kafka 2.12-2.5.0/
  kafka_2.12-2.5.0/LICENSE
  $ ll
  $ cd kafka_2.12-2.5.0
  ```
- 카프카 힙 메모리 설정
  - 카프카 브로커를 실행하기 위해서는 힙 메모리 설정이 필요
  - 카프카 브로커는 레코드의 내용은 페이지 캐시로 시스템 메모리를 사용하고 나머지 객체들을 힙 메모리에 저장하여 사용한다는 특징이 있다.
  - 카프카 패키지의 힙 메모리는 카프카 브로커는 1G, 주키퍼는 512MB로 기본 설정되어 있다.
  - 실습용 인스턴스는 1G 메모리를 갖고 있으므로 카프카 브로커와 주키퍼를 동시에 실행하면 실행 불가
  ➡️ 다음 명령어로 힙 메모리 사이즈 환경변수로 지정 (다음 내용을` ~/.bashrc` 파일에 넣으면 된다)
  ```bash
  # User specific aliases and functions
  $ export KAFKA_HEAP_OPTS="-Xmx400m -Xms400m"
  $ echo $KAFKA_HEAP_OPS
  -Xmx400m -Xms400m
  ```
  - 카프카 브로커 실행 시 메모리를 설정하는 부분은 카프카를 실행하기 위해서 사용하는 kafka-server-start.sh 스크립트 내부에서 확인 가능
- 카프카 브로커 실행 옵션 설정
  ```bash
  $ vi config/server.properties
  ```
- 주키퍼 실행
  - 카프카 바이너리가 포함된 폴더에는 브로커와 같이 실행할 주키퍼가 준비되어 있다.
  - 주키퍼는 카프카의 클러스터 설정 리더 정보, 컨트롤러 정보를 담고 있어 카프카를 실행하는 데에 필요한 필수 애플리케이션이다.
  - 주키퍼를 상용 환경에서 안전하게 운영하기 위해서는 3대 이상의 서버로 구성하여 사용하지만 실습에서는 동일한 서버에 카프카와 동시에 1대만 실행시켜 사용
    - 1대만 실행하는 주키퍼를 'Quick-and-dirty single-node'라고 부른다.
    - 테스트 목적으로만 해야 한다.
    
